---
- name: Copying docker-compose.yml file on the server
  copy:
    src: "/opt/tools/app/docker-compose.yml"
    dest: "/home/{{ ansible_user }}/docker-compose.yml"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: u=rw,g=rw,o=r


- name: Create local SC4S directory if it doesn't exist
  file:
    path: /opt/sc4s
    state: directory
    mode: '0755'

- name: Create SC4S/tls directory if it doesn't exist
  file:
    path: /opt/sc4s/tls
    state: directory
    mode: '0755'

- name: Create SC4S/archive directory if it doesn't exist
  file:
    path: /opt/sc4s/archive
    state: directory
    mode: '0755'

- name: Create SC4S/local directory if it doesn't exist
  file:
    path: /opt/sc4s/local
    state: directory
    mode: '0755'

- name: Copying env_file file on the server
  copy:
    src: "/opt/tools/env_file"
    dest: "/opt/sc4s/env_file"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: u=rw,g=rw,o=r

- name: Create splunk-sc4s-var volume
  docker_volume:
    name: splunk-sc4s-var

- name: Running docker compose for SC4S
  docker_stack:
    state: present
    name: SC4S
    compose:
      - "/home/{{ ansible_user }}/docker-compose.yml"

