<form version="1.1" theme="dark">
  <label>SC4S Metrics</label>
  <description>Monitor SC4S instances connected to this Splunk instance.</description>
  <search id="baseSearch">
    <query>
    | mstats 
    max("spl.sc4syslog.center.received.processed")
    max("spl.sc4syslog.destination.processed")
    max("spl.sc4syslog.dst.dropped")
    max("spl.sc4syslog.dst.queued")
    prestats=true
    WHERE "index"="_metrics"
    BY sc4s_container
    span=$span$
    | search sc4s_container=$sc4s_instance$
    </query>
    <earliest>$time_range.earliest$</earliest>
    <latest>$time_range.latest$</latest>
    <sampleRatio>1</sampleRatio>
  </search>
  <fieldset submitButton="false"></fieldset>
  <row>
    <panel>
      <input type="dropdown" token="span" searchWhenChanged="true">
        <label>Span</label>
        <choice value="30s">30s</choice>
        <choice value="1m">1m</choice>
        <choice value="3m">3m</choice>
        <choice value="30m">30m</choice>
        <choice value="1h">1h</choice>
        <default>30s</default>
        <initialValue>30s</initialValue>
      </input>
      <input type="time" token="time_range">
        <label>Timer</label>
        <default>
          <earliest>rt-15m</earliest>
          <latest>rt</latest>
        </default>
      </input>
      <html>
        <p>Choose time interval and window.</p>
        <p>By default, dashboard loads metrics from every 30 seconds in the past 15 minutes.</p>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>Received Messages by SC4S Instance</title>
      <html>
<p>This is a cumulative sum that grows over the entire runtime of the instance and decreases to zero after a restart.</p>
<p>In the case of a healthy SC4S instance, the message count will increase by the number of received events plus one.</p>
<p>Idle SC4S instance sends a single metrics message every 30 seconds on its own.</p>
      </html>
      <chart>
        <search>
          <query>| mstats max("spl.sc4syslog.source.processed") prestats=true WHERE "index"="_metrics" span=$span$ BY sc4s_container
| timechart max("spl.sc4syslog.source.processed") span=$span$ useother=false BY sc4s_container WHERE max in top5
| fields - _span*</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">auto</option>
        <option name="charting.axisY.includeZero">1</option>
        <option name="charting.axisY.scale">log</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.chart.showDataLabels">minmax</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.gridLinesX.showMajorLines">1</option>
        <option name="charting.layout.splitSeries">1</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">1</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">seriesCompare</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
    <panel>
      <title>Dropped Messages by SC4S Instance</title>
      <html>
<p>This is a cumulative sum that, in the absence of dropped messages, remains at a constant level of 0.</p>
<p>Upon restarting the SC4S instance, it is reset back to 0.</p>
<p>A rising graph indicates an increase in the number of dropped messages, while a flat graph signifies the absence of new dropped messages.</p>
      </html>
      <chart>
        <search>
          <query>| mstats max("spl.sc4syslog.dst.dropped") prestats=true WHERE "index"="_metrics" span=$span$ BY sc4s_container
| timechart max("spl.sc4syslog.dst.dropped") span=$span$ useother=false BY sc4s_container WHERE max in top5
| fields - _span*</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">auto</option>
        <option name="charting.axisY.includeZero">1</option>
        <option name="charting.axisY.scale">log</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.chart.showDataLabels">minmax</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.gridLinesX.showMajorLines">1</option>
        <option name="charting.layout.splitSeries">1</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">1</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">seriesCompare</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>SC4S Metrics</title>
      <input type="dropdown" token="sc4s_instance" searchWhenChanged="true">
        <label>SC4S Instance</label>
        <fieldForLabel>values(sc4s_container)</fieldForLabel>
        <fieldForValue>values(sc4s_container)</fieldForValue>
        <search>
          <query>| mcatalog values(sc4s_container) WHERE index=_metrics | mvexpand values(sc4s_container)</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
      </input>
      <html>
        <p>Choose SC4S container</p>
      </html>
      <single>
        <title>Container</title>
        <search>
          <query>| mcatalog values(sc4s_container) WHERE index=_metrics | mvexpand values(sc4s_container)</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="drilldown">none</option>
      </single>
      <single>
        <title>Version</title>
        <search>
          <query>| mcatalog values(sc4s_version) WHERE index=_metrics | mvexpand values(sc4s_version)</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <html>
      <h2>
      Messages Per 30-Second Interval
      </h2>
      <p>A healthy, idle instance of SC4S receives one message every 30 seconds, and this message contains metrics. If SC4S receives N events, the chart should return a value of N + 1 for given 30 seconds range.</p>
      <p>The 'queued' value increases temporarily in case of a connection loss to Splunk or increased system load, while the 'dropped' value temporarily rises during periods of system load exceeding its capacity.</p>
    </html>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <search base="baseSearch">
          <query>| timechart
max("spl.sc4syslog.center.received.processed") AS received
max("spl.sc4syslog.dst.dropped") AS dropped 
max("spl.sc4syslog.dst.queued") AS queued
span=$span$
| delta received as received
| delta dropped as dropped
| fields - _span*</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.overlayFields">queued</option>
        <option name="charting.chart.showDataLabels">minmax</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
</form>