#this parser can be used for "almost compliant" 5424 messages
block parser p_RFC5424-lite(prefix(".rfc5424-lite.")) {
    channel {
        rewrite {
            # Remove Version Identifier
              subst('(<\d+>)\d+' "$1" value("MSG"));

        };
        parser {
            # by this time this message will parse with the BSD 3164 parser
            syslog-parser(time-zone(`default-timezone`));
            # syslog-parser();

        # extract name-value pairs.
        # kv-parser(prefix("`prefix`"));
        };
    };
};

block parser p_test-parser(prefix(".testparse.")) {
    channel {
        rewrite {
            # Put your rewrite rule here;use "MSG" as no-parse() puts entire payload there
            # subst('(>.{12})\s' "${1}T" value("MSG"));
        };
        parser {
            # Don't initially parse so full output can be seen
            # syslog-parser(time-zone(`default-timezone`) flags(syslog-protocol));
            # syslog-parser();
            # syslog-parser(time-zone(`default-timezone`));
            # date-parser(format("%Y-%m-%d %H:%M:%S") template("$(substr ${MESSAGE} 0 19)") time-zone(`default-timezone`));
        };
    };
};

#Used by fallback to log everything we can
block rewrite r_set_splunk(sourcetype(`splunk-sourcetype`)
                           index(`splunk-index`)
                           template(`splunk-default-template`)
                           vendor("unassigned")
                           category("")
                           filename("messages")
                          ) {
      set("`index`", value(".splunk.index"));
      set("`sourcetype`", value(".splunk.sourcetype"));
      set("`template`", value(".splunk.template"));
      set("`vendor`", value(".splunk.vendor"));
      set("`category`", value(".splunk.category"));
      set("`filename`", value(".splunk.filename"));
      set($FACILITY, value("fields.facility"));
      set($LEVEL, value("fields.severity"));
      set($LOGHOST, value("fields.syslog-server"));
  };

#Used when for normal filters index and sourcetype must be set in a prior re-write or context
block rewrite r_set_splunk_basic(
                           template(`splunk-default-template`)
                           vendor("unassigned")
                           category("")
                           filename("messages")
                          ) {
      set("`template`", value(".splunk.template"));
      set("`vendor`", value(".splunk.vendor"));
      set("`category`", value(".splunk.category"));
      set("`filename`", value(".splunk.filename"));
      set($FACILITY, value("fields.facility"));
      set($LEVEL, value("fields.severity"));
      set($LOGHOST, value("fields.syslog-server"));
  };
