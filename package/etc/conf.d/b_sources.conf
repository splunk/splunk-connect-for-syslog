# ===============================================================================================
# Source block for data arriving on unique ports; parsing defaults to "no-parse"
# ===============================================================================================

block source s_unique-ports(udp_port() tcp_port() flags("no-parse")) {
     `splunk-udp-driver` ( 
           transport("udp") 
           port(`udp_port`)  
           ip-protocol(`ip-version`)
#          hook-commands(
#          setup("firewall-cmd --permanent --add-port=514/udp")
#          teardown("firewall-cmd --permanent --remove-port=514/udp")
#          )
           so-rcvbuf(`splunk-rcvbuf`)
           keep-hostname(yes)
           keep-timestamp(yes)
           use-dns(no)
           use-fqdn(no)
           chain-hostnames(off)
           flags(`flags`)
           );

     `splunk-tcp-driver`  ( 
           transport("tcp") 
           port(`tcp_port`)  
           ip-protocol(`ip-version`)
#          hook-commands(
#              setup("firewall-cmd --permanent --add-port=514/tcp")
#              teardown("firewall-cmd --permanent --remove-port=514/tcp")
#              )
           max-connections(`splunk-max-connections`)
           log-iw-size(`splunk-window-size`)
           log-fetch-limit(`splunk-fetch-limit`)
           keep-hostname(yes)
           keep-timestamp(yes)
           use-dns(no)
           use-fqdn(no)
           chain-hostnames(off)
           flags(`flags`)
           );
};

block source s_unique-udp-port(udp_port() flags("no-parse")) {
     `splunk-udp-driver` (
           transport("udp")
           port(`udp_port`)
           ip-protocol(`ip-version`)
#          hook-commands(
#          setup("firewall-cmd --permanent --add-port=514/udp")
#          teardown("firewall-cmd --permanent --remove-port=514/udp")
#          )
           so-rcvbuf(`splunk-rcvbuf`)
           keep-hostname(yes)
           keep-timestamp(yes)
           use-dns(no)
           use-fqdn(no)
           chain-hostnames(off)
           flags(`flags`)
           );
};

block source s_unique-tcp-port(tcp_port() flags("no-parse")) {
     `splunk-tcp-driver`  (
           transport("tcp")
           port(`tcp_port`)
           ip-protocol(`ip-version`)
#          hook-commands(
#              setup("firewall-cmd --permanent --add-port=514/tcp")
#              teardown("firewall-cmd --permanent --remove-port=514/tcp")
#              )
           max-connections(`splunk-max-connections`)
           log-iw-size(`splunk-window-size`)
           log-fetch-limit(`splunk-fetch-limit`)
           keep-hostname(yes)
           keep-timestamp(yes)
           use-dns(no)
           use-fqdn(no)
           chain-hostnames(off)
           flags(`flags`)
           );
};
