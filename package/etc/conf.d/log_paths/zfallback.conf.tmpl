log {
    source(s_DEFAULT);

    rewrite {
        r_set_splunk_dest_default(sourcetype("sc4s:fallback"), index("main"), template("t_JSON"));
        set("$(template ${fields.sc4s_template} $(template t_JSON))" value("MSG"));
    };
    parser {
        p_add_context_splunk(key("sc4s_fallback"));
    };

{{- if ((bool (getenv "SC4S_DEST_HEC_GLOBAL" "yes")) or (bool (getenv "SC4S_DEST_FALLBACK_HEC" "yes"))) }}
    destination(d_hec);  #--HEC--
{{- end}}

{{- if (getenv "SC4S_ARCHIVE_GLOBAL") or (getenv "SC4S_ARCHIVE_FALLBACK") }}
    destination(d_archive);
{{- end}}

    flags(flow-control,fallback);
};
