block parser app-fallback-nix_syslog() {    
 channel {
        rewrite {
            r_set_splunk_dest_default(
                index("osnix")
                sourcetype('nix:syslog')
                vendor('${.netsource.sc4s_vendor}')
                product('${.netsource.sc4s_product}')
                class('${.netsource.sc4s_class}')
            );            
        };       

        rewrite {
            set("${PROGRAM}", value(".PROGRAM"));
            subst('^\/(?:[^\/]+\/)+', "" , value(".PROGRAM"));
            r_set_splunk_dest_update(
                 source('program:${.PROGRAM}')
                 class('nix_syslog')                        
            );
        };
   };
};
application app-fallback-nix_syslog[fallback] {
	filter { 
        (
            filter(f_is_rfc5424_strict);
            or (
                filter(f_is_rfc3164) 
                and "${PROGRAM}" ne ""
                and "${MESSAGE}" ne ""
            )
        )
        and "${fields.sc4s_vendor}" eq ""
        and "${fields.sc4s_product}" eq ""
    };	
    parser { app-fallback-nix_syslog(); };   
};
