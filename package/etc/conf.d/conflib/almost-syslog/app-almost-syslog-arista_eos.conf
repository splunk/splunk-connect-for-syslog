block parser app-almost-syslog-arista_eos() {    
    channel {
        #
        parser {
            regexp-parser(
                prefix(".tmp.")
                patterns('^(?<pri>\<\d+\>) ?(?<timestamp>[^ ]+) (?<host>[^ ]+) (?<program>portsec|aaa|accounting|acl|agent|ale|arp|bfd|bgp|bmp|capacity|capi|clear|cvx|dataplane|dhcp|dot1x|dscp|envmon|eth):(?: (?<seq>\d+):)? (?<message>%[A-Z]+-\d+-[^: ]+: .*)')
                flags(ignore-case)
            );
            syslog-parser(
                flags(assume-utf8, guess-timezone)
                template("${.tmp.pri} ${.tmp.timestamp} ${.tmp.host} ${.tmp.program}: ${.tmp.message}")
            );
        };    
        rewrite {
            set('${.tmp.seq}' value('fields.seq') condition("${.tmp.seq}" ne ""));
            r_set_splunk_dest_default(
                index('netops')
                sourcetype('arista:eos:$(lowercase ${.tmp.program})')
                vendor("arista")
                product("eos")                
                class('$(lowercase ${.tmp.program})')
            ); 
        };
        rewrite {
            set('${.tmp.seq}' value('fields.seq') condition("${.tmp.seq}" ne ""));
                    set("rfc_arista_eos", value("fields.sc4s_syslog_format"));
        }; 
    };
};

application app-almost-syslog-arista_eos[sc4s-almost-syslog] {
	filter { 
        message(': %' type(string) flags(substring));        
    };	

    parser { app-almost-syslog-arista_eos(); };      
};
