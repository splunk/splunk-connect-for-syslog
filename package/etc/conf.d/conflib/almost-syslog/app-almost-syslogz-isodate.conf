block parser app-almost-syslogz-isodate() {    
    channel {
        parser {             
            regexp-parser(
                prefix(".tmp.")
                patterns('^(?<pri>\<\d+\>)1?(?: *)(?<timestamp>\d{4}-\d{2}-\d{2}(?: |T)?\d{2}:\d{2}:\d{2}(?:[\.,]\d+)?(?:[+-]\d{2}:?\d{2}|Z)?) *(?<message>.*)')
            );   
        };
        if {
            parser { 
                date-parser(
                    format(
                        '%Y-%m-%dT%T.%f%z',
                        '%Y-%m-%dT%T,%f%z',
                        '%Y-%m-%dT%T%z',                    
                        '%Y-%m-%d %T.%f%z',
                        '%Y-%m-%d %T,%f%z',
                        '%Y-%m-%d %T%z',                    
                        '%Y-%m-%d%T.%f%z',
                        '%Y-%m-%d%T,%f%z',
                        '%Y-%m-%d%T%z',                    
                    ) 
                    template("${.tmp.timestamp}")
                );
            };  
        } else {
            parser { 
                date-parser(
                    format(
                        '%Y-%m-%dT%T.%f',
                        '%Y-%m-%dT%T,%f',
                        '%Y-%m-%dT%T',                    
                        '%Y-%m-%d %T.%f',
                        '%Y-%m-%d %T,%f',
                        '%Y-%m-%d %T',                    
                        '%Y-%m-%d%T.%f',
                        '%Y-%m-%d%T,%f',
                        '%Y-%m-%d%T',                    
                    ) 
                    flags(guess-timezone)
                    template("${.tmp.timestamp}")
                );
            };  
        };
        parser {
            syslog-parser(
                flags(assume-utf8)
                template("${.tmp.pri} $S_ISODATE ${.tmp.message}")
            );
        };
                    
        
        rewrite {
            groupunset(values(".tmp.*"));
            set("rfc3164_isodate", value("fields.sc4s_syslog_format"));
        };                       
        
    };
};
application app-almost-syslogz-isodate[sc4s-almost-syslog] {
    parser { app-almost-syslogz-isodate(); };   
};
