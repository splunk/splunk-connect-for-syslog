block parser syslog_isodate-parser() {    
 channel {
        filter { 
            message('^(?<PRI>\<\d+\>)1?(?: *)(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:[+-]\d{2}:?\d{2}|Z)) ([^\s,]+)[\s,](.*)', flags(store-matches));
        };  
        rewrite {
            set("$MESSAGE", value("RAWMSG"));
            set("$3", value("HOST"));
        };
        parser {
            syslog-parser(
                flags(assume-utf8)
                template("$1 $4")
            );
        };
        if {
            filter {
                match('(.*[+-]\d\d):(\d\d)' value('2') flags(store-matches))
            };
            parser { 
                date-parser(
                    format(
                        '%Y-%m-%dT%T.%f%z',
                        '%Y-%m-%dT%T%z',                    
                    ) 
                    template("$1$2")
                );
            };        
        } else {
            parser { 
                date-parser(
                    format(
                        '%Y-%m-%dT%T.%f%z',
                        '%Y-%m-%dT%T%z',                    
                    ) 
                    template("$2")
                );
            };        
        };

        
        rewrite {
            set("rfc3164_isodate", value("fields.sc4s_syslog_format"));
        };                       
        
   };
};
application syslog_isodate[sc4s-almost-syslog] {
    parser { syslog_isodate-parser(); };   
};
