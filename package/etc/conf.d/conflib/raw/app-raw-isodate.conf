block parser raw_isodate-parser() {    
 channel {
        filter { 
            message('^(\d{4}-\d{2}-\d{2}(?: |T)?\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:[+-]\d{2}:?\d{2}|Z)?)(.*)', flags(store-matches));
        };  
        rewrite {
            set("$MESSAGE", value("RAWMSG"));
        };
        rewrite {
            set("$2", value("MESSAGE"));
        };
        if {
            parser { 
                date-parser(
                    format(
                        '%Y-%m-%dT%T.%f%z',
                        '%Y-%m-%dT%T%z',                    
                        '%Y-%m-%d %T.%f%z',
                        '%Y-%m-%d %T%z',                    
                        '%Y-%m-%d%T.%f%z',
                        '%Y-%m-%d%T%z',                    
                    ) 
                    template("$1")
                );
            };  
        } else {
            parser { 
                date-parser(
                    format(
                        '%Y-%m-%dT%T.%f',
                        '%Y-%m-%dT%T',                    
                        '%Y-%m-%d %T.%f',
                        '%Y-%m-%d %T',                    
                        '%Y-%m-%d%T.%f',
                        '%Y-%m-%d%T',                    
                    ) 
                    flags(guess-timezone)
                    template("$1")
                );
            };  
        };
            
        
        rewrite {
            set("raw_isodate", value("fields.sc4s_syslog_format"));
        };                       
        
   };
};
application raw_isodate[sc4s-raw-syslog] {
    parser { raw_isodate-parser(); };   
};
