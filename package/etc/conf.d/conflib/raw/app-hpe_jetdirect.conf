block parser hpe_jetdirect-parser() {    
 channel {
                
        parser {
            syslog-parser(

                flags(assume-utf8, store-raw-message)
                );

        };
        rewrite {
            set("$(template t_hdr_msg)" value("MSG"));
            unset(value("PROGRAM"));
        };   
                       
        parser {
	        # split msg and header right before the '%', Cisco messages may
            # have a variable number of ': ' terminated values
            csv-parser(delimiters(chars('') strings(';'))
                       columns('summary', 'details') 
                       prefix('.hpejetdirect.') 
                       flags(greedy, drop-invalid));
            kv-parser(
                prefix(".hpejetdirect.") template("${.hpejetdirect.details}")
            );
        };

        if {
            filter {
                match(
                    '^(\d\d\d\d-\w\w\w-\d\d \d\d:\d\d \w\w) \([^\d+-]+([-+]\d\d):(\d\d)'
                    flags(store-matches)
                    value(".hpejetdirect.time")
                )
            };

            parser { date-parser-nofilter(format(
                    '%Y-%b-%d %I:%M %p%z %S',
                    )
                    template("$1$2$3 00"));
            };
        };


        rewrite {
            set("hpe_jetdirect", value("fields.sc4s_syslog_format"));
            set("hpe_jetdirect", value("fields.sc4s_vendor_product"));                            
            set("print", value(".splunk.index"));
            set("SC4S", value(".splunk.source"));
            set("hpe:jetdirect", value(".splunk.sourcetype"));
            #set-tag("noparse");
        };                   
        rewrite { 
            set("yes", 
                value(".dest.global.hec") 
                condition(
                    '$(if ("`SC4S_DEST_SPLUNK_HEC_GLOBAL`" ne "") "`SC4S_DEST_SPLUNK_HEC_GLOBAL`" "yes")' ne "no"
                )
            );            
            set("yes", 
                value(".dest.global.archive") 
                condition(
                    '$(if ("`SC4S_ARCHIVE_GLOBAL`" ne "") "`SC4S_ARCHIVE_GLOBAL`" "no")' ne "no"
                ) 
            );
            set("yes", 
                value(".dest.global.alts") 
                condition(
                    '$(if ("`SC4S_DEST_GLOBAL_ALTERNATES`" ne "") "yes" "no")' ne "no"
                ) 
            );
            set("`SC4S_DEST_HPE_JETDIRECT_ALTERNATES`", 
                value(".dest.select.alts") 
                condition(
                    '$(if ("`SC4S_DEST_HPE_JETDIRECT_ALTERNATES`" ne "") "yes" "no")' ne "no"
                ) 
            );
            set("`SC4S_DEST_HPE_JETDIRECT_FILTERED_ALTERNATES`", 
                value(".dest.select.filteredalts") 
                condition(
                    '$(if ("`SC4S_DEST_HPE_JETDIRECT_FILTERED_ALTERNATES`" ne "") "yes" "no")' ne "no"               
                ) 
            );      
        };
        parser {p_add_context_splunk(key("${fields.sc4s_vendor_product}")); };
        parser (compliance_meta_by_source);

   };
};
application hpe_jetdirect[raw-syslog] {
	filter { 
        message('<\d+> (printer|scanner): [^;]+; ');
    };	

    parser { hpe_jetdirect-parser(); };   
};

