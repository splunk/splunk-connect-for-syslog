# Citrix NetScaler RFC5424 netsource parser
# Matches RFC 5424 format messages from NetScaler when sent to a dedicated port
#
# To use this parser, configure a dedicated port for NetScaler RFC5424 logs:
#   SC4S_LISTEN_CITRIX_NETSCALER_RFC5424_TCP_PORT=<port>
#   SC4S_LISTEN_CITRIX_NETSCALER_RFC5424_UDP_PORT=<port>
#   SC4S_LISTEN_CITRIX_NETSCALER_RFC5424_TLS_PORT=<port>
#   SC4S_LISTEN_CITRIX_NETSCALER_RFC5424_RFC5425_PORT=<port>  (RFC5424 over TLS)
#
# Example message:
# <134>1 2025-01-01T17:00:30Z HOST TCP PID - - default CONN 10000000 0 : Source 192.168.0.0:1000 ...

block parser app-netsource-citrix_netscaler_rfc5424() {
    channel {
        rewrite {
            r_set_splunk_dest_default(
                index('netfw')
                sourcetype('citrix:netscaler:syslog')
                vendor('citrix')
                product('netscaler')
            );
        };
    };
};

application app-netsource-citrix_netscaler_rfc5424[sc4s-network-source] {
    filter {
        not filter(f_is_source_identified)
        and tags(".source.s_CITRIX_NETSCALER_RFC5424")
    };
    parser { app-netsource-citrix_netscaler_rfc5424(); };
};
